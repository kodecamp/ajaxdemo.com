(function() {
  function submitForm() {
    const formElement = document.querySelector('#form');
    const formData = new FormData(formElement);
    const xhr = new XMLHttpRequest();
    xhr.addEventListener('load', function(e) {
      console.log('response received : ', xhr.response);
      displayMessage(xhr);
    });
    xhr.open('POST', "http://ajaxwebapp.com/submit-form.php");
    xhr.responseType = 'text';
    xhr.send(formData);
  }

  function displayMessage(xhr) {
    let msgClass = "";
    const message = xhr.status === 200 ? (msgClass = "info", "Submitted Successfully.") : (msgClass = "error", "Something went wrong.");
    console.log(msgClass);
    console.log(message);
    const msgPanel = document.querySelector('.message-panel');
    msgPanel.textContent = message;
    msgPanel.classList.remove('hide');
    msgPanel.classList.add(msgClass);
  }

  function displayImage(event) {
    const reader = new FileReader();
    // console.log(this.files[0]);
    reader.addEventListener('load', function(e) {
      console.log(e.target.result);
      const imageToBeUploaded = document.querySelector('#imageToBeUploaded');
      imageToBeUploaded.src = e.target.result;
    });
    reader.readAsDataURL(event.target.files[0]);
    // console.log(dataUrl);
    
  }


  function init() {

    const fileUploadElement = document.querySelector('#fileUpload');
    fileUploadElement.addEventListener('change', displayImage);

    const submitBtn = document.querySelector('#submitBtn');
    submitBtn.addEventListener('click', function(e) {
      submitForm();
    });

    const msgPanel = document.querySelector('.message-panel');
    msgPanel.addEventListener('dblclick', function(e) {
      e.target.classList.add("hide");
    });
  }

  init();
})();